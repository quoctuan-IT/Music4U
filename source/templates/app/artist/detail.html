{% extends "base.html" %}

{% load static %}

{% block title %}{{ artist.name }} - Artist{% endblock %}

{% block content %}

<!-- Messages -->
{% include 'partials/message.html' %}

<div class="container py-4">
    <div class="row justify-content-center">
        <!-- Artist Profile -->
        <div class="col-md-4 mb-4">
            <div class="card shadow-lg border-0 bg-dark text-white">

                {% if artist.image %}
                <img src="{{ artist.image.url }}" class="card-img-top img-fluid w-100 artist-img-detail"
                    alt="{{ artist.name }}">
                {% else %}
                <img src="{% static 'images/logo-IT.png' %}" class="card-img-top img-fluid w-100 artist-img-detail"
                    alt="No Image">
                {% endif %}

                <div class="card-body">
                    <h2 class="card-title">{{ artist.name }}</h2>
                    <p class="card-text">

                        {% if artist.bio %}
                        {{ artist.bio }}
                        {% else %}
                        <span class="text-muted">No bio available</span>
                        {% endif %}

                    </p>
                </div>
            </div>
        </div>


    </div>

    {% if songs %}
        <div class="mb-4 d-flex justify-content-center">
            <button class="btn btn-primary" onclick="playAllSongs()">‚ñ∂Ô∏è Play All</button>
        </div>
    <!-- Now Playing Section -->
    {% include 'partials/music_player.html' %}

    <!-- Song List -->
    <div class="card shadow-sm border-0">
        <div class="card-header text-black d-flex justify-content-between align-items-center"
            style="background-color: pink;">
            <h5 class="mb-0">
                Songs by {{ artist.name }}
            </h5>
        </div>

        <div class="list-group list-group-flush" id="songList">

            {% for song in songs %}
            {% include 'partials/song_list.html' %}
            {% endfor %}

        </div>
    </div>
    {% else %}
    <div class="text-center py-2">
        <h4 class="mb-3">No Songs found</h4>
        <p class="mb-4">This artist hasn't uploaded any songs yet!</p>
        <a href="{% url 'index' %}" class="btn btn-primary btn-lg">
            <i class="fas fa-search me-2"></i>Discover Music
        </a>
    </div>
    {% endif %}

</div>


<script>
    const songs = [
        {% for song in songs %}
    {
        title: "{{ song.title|escapejs }}",
            artist: "{{ song.artist|escapejs }}",
                url: "{{ song.audio_file.url }}"
    },
    {% endfor %}
    ];

    let currentIndex = 0;
    const player = document.getElementById("audioPlayer");
    const nowPlaying = document.getElementById("nowPlaying");
    const songList = document.querySelectorAll(".song-item");

    function highlightCurrentSong() {
        songList.forEach(item => item.classList.remove("bg-success", "text-white"));
        if (songList[currentIndex]) {
            songList[currentIndex].classList.add("bg-success", "text-white");
        }
    }

    function playAllSongs() {
        if (songs.length === 0) return;

        currentIndex = 0;
        player.src = songs[currentIndex].url;
        player.play();
        updateNowPlaying();
        highlightCurrentSong();
    }

    function playNextSong() {
        currentIndex++;
        if (currentIndex < songs.length) {
            player.src = songs[currentIndex].url;
            player.play();
            updateNowPlaying();
            highlightCurrentSong();
        } else {
            nowPlaying.innerText = "All songs played.";
        }
    }

    function togglePlay() {
        if (player.paused) {
            player.play();
        } else {
            player.pause();
        }
    }

    function updateNowPlaying() {
        nowPlaying.innerText = `üéß ${songs[currentIndex].title} - ${songs[currentIndex].artist}`;
    }

    // Auto play next song
    player.onended = playNextSong;
</script>


{% endblock %}